var dataBase=new function(){this.connected=false;this.connection;this.name;this.version;this.isConnected=function(){return(this.connection!=null&&this.connected)};this.setName=function(a){this.name=a;return true};this.setVersion=function(a){this.version=a;return true};this.getInfo=function(){return{name:this.name,version:this.version,connected:this.connected}};this.Batch=function(b,a,c){if(b!=null&&this.connection!=null&&this.connected){this.connection.transaction(function(d){for(key in a){console.log('Saving key "'+key+'" with value "'+a[key]+'"');d.executeSql(b,[key,a[key]])}if(c!=null){c(d,true)}},function(d){if(c!=null){c(null,d)}})}else{if(c!=null){c(null,false)}}};this.Query=function(a,b){if(a!=null&&this.connection!=null&&this.connected){this.connection.transaction(function(c){c.executeSql(a,[],b)},function(c){if(b!=null){b(null,c)}})}else{if(b!=null){b(null,false)}}};this.Connect=function(b,a){if(typeof b!=="undefined"&&b!==null){this.name=b}if(typeof a!=="undefined"&&a!==null){this.version=a}this.connection=null;if(this.name!=null&&this.version!=null){this.connection=openDatabase(this.name,this.version,this.name+" "+this.version,65536)}if(this.connection!=null){this.connected=true;return true}else{return false}}};var settingsBridge=new function(){var a=this;this.name;this.version;this.loaded=true;this.storage={};this.setDefaults=function(){var b=false;var c={widgetColor:"black",widgetLang:"EN",clockFormat:"24",weatherEnable:"true",weatherFormat:"EU",weatherPlace:"",weatherLength:"4",};for(key in c){if(this.storage[key]==null){this.storage[key]=c[key];b=true}}if(b){this.Save()}};this.setName=function(b){this.name=b;return true};this.setVersion=function(b){this.version=b;return true};this.isLoaded=function(b){return this.loaded};this.Set=function(b,d,c){if(this.loaded){this.storage[b]=d;if(c){return this.Save()}return true}return false};this.Get=function(b){if(this.loaded){return this.storage[b]}return false};this.Save=function(){if(this.loaded){dataBase.Batch('INSERT OR REPLACE INTO settings ("name", "value") VALUES (?, ?)',this.storage);return true}return false};this.Load=function(c,b,d){if(typeof c!=="undefined"&&c!==null){this.name=c}if(typeof b!=="undefined"&&b!==null){this.version=b}if(dataBase!=null&&this.name!=null&&this.version!=null){if(!dataBase.connected&&!dataBase.Connect(this.name,this.version)){if(d!=null){d(false,"No database connect")}return false}dataBase.Query("CREATE TABLE IF NOT EXISTS settings (name unique, value)",function(f,e){if(f!=null){dataBase.Query("SELECT * FROM settings",function(h,j){if(h!=null){var g=j.rows.length,k;for(k=0;k<g;k++){var l=j.rows.item(k);a.Set(l.name,l.value)}a.setDefaults();a.loaded=true;if(d!=null){d(true)}}else{this.loaded=false;if(d!=null){d(false,j)}}})}else{this.loaded=false;if(d!=null){d(false,e)}}});return false}if(d!=null){d(false,"No db query possible")}return false}};var widget=new function(){var a=this;this.lang={};this.swipe;this.setLanguage=function(){switch(settingsBridge.Get("widgetLang")){case"DE":this.lang.WEEKS=["SO","MO","DI","MI","DO","FR","SA"];this.lang.MONTHS=["JAN","FEB","M&Auml;R","APR","MAI","JUN","JUL","AUG","SEP","OKT","NOV","DEZ"];break;case"FR":this.lang.WEEKS=["DI","LU","MA","ME","JE","VE","SA"];this.lang.MONTHS=["JAN","F&Eacute;V","MAR","AVR","MAI","JUI","JUI","AO&Ucirc;","SEP","OCT","NOV","D&Eacute;C"];break;case"IT":this.lang.WEEKS=["DO","LU","MA","ME","GI","VE","SA"];this.lang.MONTHS=["GEN","FEB","MAR","APR","MAG","GIU","LUG","AGO","SET","OTT","NOV","DIC"];break;case"ES":this.lang.WEEKS=["DO","LU","MA","MI","JU","VI","SA"];this.lang.MONTHS=["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SET","OCT","NOV","DIC"];break;case"DA":this.lang.WEEKS=["S&Oslash;","MA","TI","ON","TO","FR","L&Oslash;"];this.lang.MONTHS=["JAN","FEB","MAR","APR","MAJ","JUN","JUL","AUG","SEP","OKT","NOV","DEC"];break;default:this.lang.WEEKS=["SU","MO","TU","WE","TH","FR","SA"];this.lang.MONTHS=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];break}};this.setStyle=function(){document.body.className=settingsBridge.Get("widgetColor");var b=window.screen.height;if(b==568){document.body.style.height="568px"}else{document.body.style.height="480px"}};this.updateClock=function(){var h=document.getElementById("time");var c=document.getElementById("date");var e=new Date();var d=e.getDate();if(d<10){d="0"+d}var g=widget.lang.WEEKS[e.getDay()];var f=widget.lang.MONTHS[e.getMonth()];c.innerHTML=g+" "+d+" "+f;var b=e.getHours();if(b>12&&settingsBridge.Get("clockFormat")==12){b=b-12}if(b<10){b="0"+b}var i=e.getMinutes();if(i<10){i="0"+i}h.innerHTML=b+":"+i;setTimeout(widget.updateClock,100)};this.renderError=function(c){var b=document.getElementById("error");b.innerHTML=c;b.style.display="block"};this.renderWeather=function(i){var j=settingsBridge.Get("widgetColor");var r=settingsBridge.Get("weatherFormat");var p=document.getElementById("weather");var b=document.getElementById("copyright");var l=document.getElementById("link");if(l!=null){l.href="http://www.yr.no/place/"+settingsBridge.Get("weatherPlace")}for(index in i){var e=i[index];var q=document.createElement("tr");var h=document.createElement("th");var d=document.createTextNode(e.time);h.appendChild(d);var k=document.createElement("td");k.className="image";var o=document.createElement("img");o.src="resources/"+j+"/"+e.symbol+".png";k.appendChild(o);var m=document.createElement("td");m.className="ned";if(r=="EU"){m.innerHTML=e.rain+"<small><xs> </xs>mm</small>"}else{if(r=="US"){m.innerHTML=e.rain+"<xs> </xs>"}}var f=document.createElement("td");f.className=e.temperclass;f.innerHTML=e.temperature;var n=document.createElement("td");n.className="v";var c=document.createElement("img");c.src="resources/"+j+"/"+e.windSymbol+".png";n.appendChild(c);var g=document.createElement("td");g.className="ms";if(r=="EU"){g.innerHTML=e.windSpeed+"<small><xs> </xs>m/s<small>"}else{if(r=="US"){g.innerHTML=e.windSpeed+"<small><xs> </xs>mph<small>"}}q.appendChild(h);q.appendChild(k);q.appendChild(m);q.appendChild(f);q.appendChild(n);q.appendChild(g);p.appendChild(q)}if(b!=null){b.style.display="block"}p.style.display="block"};this.sendReport=function(b,f){var d=function(g,h){return(encodeURIComponent(g)+"="+encodeURIComponent(h)).replace(/%20/g,"+")};var c=new XMLHttpRequest();c.timeout=4000;c.ontimeout=function(){};c.onreadystatechange=function(){};var e="http://api.nawuko.de/weather/debug";c.open("POST",e,true);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.send(d("script",b)+"&"+d("text",f))};this.getWeather=function(){var c=document.getElementById("weather");c.innerHTML="";c.style.display="none";var b=new XMLHttpRequest();b.timeout=4000;b.ontimeout=function(){};b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){var e=JSON.parse(b.responseText);if(e.status==200){widget.renderWeather(e.data);setTimeout(widget.getWeather,30*60*1000)}else{widget.renderError(e.message);a.sendReport("getWeather",e.message)}}};var d="http://api.nawuko.de/weather";d+="/"+settingsBridge.Get("weatherFormat");d+="/"+settingsBridge.Get("weatherLength");d+="/"+settingsBridge.Get("weatherPlace");b.open("GET",d,true);b.send()};this.init=function(){settingsBridge.Load("parenthemeLS","1.0",function(c,b){if(c){a.setStyle();a.setLanguage();a.updateClock();a.swipe=window.swipe=Swipe(document.getElementById("content"),{continuous:false,});if(settingsBridge.Get("weatherEnable")=="true"&&settingsBridge.Get("weatherPlace")!=""){a.getWeather()}else{a.swipe.kill()}}else{a.sendReport("settingsBridge",b)}})}};document.addEventListener("DOMContentLoaded",widget.init);function Swipe(m,e){var f=function(){};var u=function(C){setTimeout(C||f,0)};var B={addEventListener:!!window.addEventListener,touch:("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch,transitions:(function(C){var E=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var D in E){if(C.style[E[D]]!==undefined){return true}}return false})(document.createElement("swipe"))};if(!m){return}var c=m.children[0];var s,d,r,g;e=e||{};var k=parseInt(e.startSlide,10)||0;var v=e.speed||300;e.continuous=e.continuous!==undefined?e.continuous:true;function n(){s=c.children;g=s.length;if(s.length<2){e.continuous=false}if(B.transitions&&e.continuous&&s.length<3){c.appendChild(s[0].cloneNode(true));c.appendChild(c.children[1].cloneNode(true));s=c.children}d=new Array(s.length);r=m.getBoundingClientRect().width||m.offsetWidth;c.style.width=(s.length*r)+"px";var D=s.length;while(D--){var C=s[D];C.style.width=r+"px";C.setAttribute("data-index",D);if(B.transitions){C.style.left=(D*-r)+"px";q(D,k>D?-r:(k<D?r:0),0)}}if(e.continuous&&B.transitions){q(i(k-1),-r,0);q(i(k+1),r,0)}if(!B.transitions){c.style.left=(k*-r)+"px"}m.style.visibility="visible"}function o(){if(e.continuous){a(k-1)}else{if(k){a(k-1)}}}function p(){if(e.continuous){a(k+1)}else{if(k<s.length-1){a(k+1)}}}function i(C){return(s.length+(C%s.length))%s.length}function a(G,D){if(k==G){return}if(B.transitions){var F=Math.abs(k-G)/(k-G);if(e.continuous){var C=F;F=-d[i(G)]/r;if(F!==C){G=-F*s.length+G}}var E=Math.abs(k-G)-1;while(E--){q(i((G>k?G:k)-E-1),r*F,0)}G=i(G);q(k,r*F,D||v);q(G,0,D||v);if(e.continuous){q(i(G-F),-(r*F),0)}}else{G=i(G);j(k*-r,G*-r,D||v)}k=G;u(e.callback&&e.callback(k,s[k]))}function q(C,E,D){l(C,E,D);d[C]=E}function l(D,G,F){var C=s[D];var E=C&&C.style;if(!E){return}E.webkitTransitionDuration=E.MozTransitionDuration=E.msTransitionDuration=E.OTransitionDuration=E.transitionDuration=F+"ms";E.webkitTransform="translate("+G+"px,0)translateZ(0)";E.msTransform=E.MozTransform=E.OTransform="translateX("+G+"px)"}function j(G,F,C){if(!C){c.style.left=F+"px";return}var E=+new Date;var D=setInterval(function(){var H=+new Date-E;if(H>C){c.style.left=F+"px";if(A){x()}e.transitionEnd&&e.transitionEnd.call(event,k,s[k]);clearInterval(D);return}c.style.left=(((F-G)*(Math.floor((H/C)*100)/100))+G)+"px"},4)}var A=e.auto||0;var w;function x(){w=setTimeout(p,A)}function t(){A=0;clearTimeout(w)}var h={};var y={};var z;var b={handleEvent:function(C){switch(C.type){case"touchstart":this.start(C);break;case"touchmove":this.move(C);break;case"touchend":u(this.end(C));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":u(this.transitionEnd(C));break;case"resize":u(n.call());break}if(e.stopPropagation){C.stopPropagation()}},start:function(C){var D=C.touches[0];h={x:D.pageX,y:D.pageY,time:+new Date};z=undefined;y={};c.addEventListener("touchmove",this,false);c.addEventListener("touchend",this,false)},move:function(C){if(C.touches.length>1||C.scale&&C.scale!==1){return}if(e.disableScroll){C.preventDefault()}var D=C.touches[0];y={x:D.pageX-h.x,y:D.pageY-h.y};if(typeof z=="undefined"){z=!!(z||Math.abs(y.x)<Math.abs(y.y))}if(!z){C.preventDefault();t();if(e.continuous){l(i(k-1),y.x+d[i(k-1)],0);l(k,y.x+d[k],0);l(i(k+1),y.x+d[i(k+1)],0)}else{y.x=y.x/((!k&&y.x>0||k==s.length-1&&y.x<0)?(Math.abs(y.x)/r+1):1);l(k-1,y.x+d[k-1],0);l(k,y.x+d[k],0);l(k+1,y.x+d[k+1],0)}}},end:function(E){var G=+new Date-h.time;var D=Number(G)<250&&Math.abs(y.x)>20||Math.abs(y.x)>r/2;var C=!k&&y.x>0||k==s.length-1&&y.x<0;if(e.continuous){C=false}var F=y.x<0;if(!z){if(D&&!C){if(F){if(e.continuous){q(i(k-1),-r,0);q(i(k+2),r,0)}else{q(k-1,-r,0)}q(k,d[k]-r,v);q(i(k+1),d[i(k+1)]-r,v);k=i(k+1)}else{if(e.continuous){q(i(k+1),r,0);q(i(k-2),-r,0)}else{q(k+1,r,0)}q(k,d[k]+r,v);q(i(k-1),d[i(k-1)]+r,v);k=i(k-1)}e.callback&&e.callback(k,s[k])}else{if(e.continuous){q(i(k-1),-r,v);q(k,0,v);q(i(k+1),r,v)}else{q(k-1,-r,v);q(k,0,v);q(k+1,r,v)}}}c.removeEventListener("touchmove",b,false);c.removeEventListener("touchend",b,false)},transitionEnd:function(C){if(parseInt(C.target.getAttribute("data-index"),10)==k){if(A){x()}e.transitionEnd&&e.transitionEnd.call(C,k,s[k])}}};n();if(A){x()}if(B.addEventListener){if(B.touch){c.addEventListener("touchstart",b,false)}if(B.transitions){c.addEventListener("webkitTransitionEnd",b,false);c.addEventListener("msTransitionEnd",b,false);c.addEventListener("oTransitionEnd",b,false);c.addEventListener("otransitionend",b,false);c.addEventListener("transitionend",b,false)}window.addEventListener("resize",b,false)}else{window.onresize=function(){n()}}return{setup:function(){n()},slide:function(D,C){t();a(D,C)},prev:function(){t();o()},next:function(){t();p()},getPos:function(){return k},getNumSlides:function(){return g},kill:function(){t();c.style.width="auto";c.style.left=0;var D=s.length;while(D--){var C=s[D];C.style.width="100%";C.style.left=0;if(B.transitions){l(D,0,0)}}if(B.addEventListener){c.removeEventListener("touchstart",b,false);c.removeEventListener("webkitTransitionEnd",b,false);c.removeEventListener("msTransitionEnd",b,false);c.removeEventListener("oTransitionEnd",b,false);c.removeEventListener("otransitionend",b,false);c.removeEventListener("transitionend",b,false);window.removeEventListener("resize",b,false)}else{window.onresize=null}}}};